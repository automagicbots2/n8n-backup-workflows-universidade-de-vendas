{
  "active": true,
  "connections": {
    "busca_variavel_refresh_token_conta_azul": {
      "main": [
        [
          {
            "node": "busca_variavel_auth_conta_Azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_variavel_auth_conta_Azul": {
      "main": [
        [
          {
            "node": "get_new_token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "8am": {
      "main": [
        [
          {
            "node": "tamanho_batching",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_variavel_access_token_conta_azul": {
      "main": [
        [
          {
            "node": "busca_variavel_refresh_token_conta_azul1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_variavel_refresh_token_conta_azul1": {
      "main": [
        [
          {
            "node": "busca_itens_totais",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza_bd1": {
      "main": [
        [
          {
            "node": "20s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza_bd": {
      "main": [
        [
          {
            "node": "define_datas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "erro_de_token": {
      "main": [
        [
          {
            "node": "get_new_token1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "sem_itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "5s": {
      "main": [
        [
          {
            "node": "loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tamanho_batching": {
      "main": [
        [
          {
            "node": "busca_variavel_refresh_token_conta_azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sem_itens": {
      "main": [
        [
          {
            "node": "5s",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "define_batching",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_itens_totais": {
      "main": [
        [
          {
            "node": "erro_de_token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_new_token1": {
      "main": [
        [
          {
            "node": "atualiza_bd1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "loop3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "loop3": {
      "main": [
        [
          {
            "node": "fim",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "entra_na_fila": {
      "main": [
        [
          {
            "node": "loop3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_contas2": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados": {
      "main": [
        [
          {
            "node": "entra_na_fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "define_datas": {
      "main": [
        [
          {
            "node": "loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_new_token": {
      "main": [
        [
          {
            "node": "atualiza_bd",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "20s": {
      "main": [
        [
          {
            "node": "busca_variavel_access_token_conta_azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "loop": {
      "main": [
        [
          {
            "node": "end",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "busca_variavel_access_token_conta_azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "define_batching": {
      "main": [
        [
          {
            "node": "dados1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados1": {
      "main": [
        [
          {
            "node": "entra_na_fila1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "entra_na_fila1": {
      "main": [
        [
          {
            "node": "loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "chega_da_fila": {
      "main": [
        [
          {
            "node": "busca_contas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "end": {
      "main": [
        [
          {
            "node": "120s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "120s": {
      "main": [
        [
          {
            "node": "aciona_automacao_envios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-24T17:37:57.858Z",
  "id": "OTrHdm5GBVkL1l9C",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "九꺀[CONTA AZUL][COBRAN칂AS][8h] - PARTE 1",
  "nodes": [
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "Refresh Token Conta Azul"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "931d3c7e-c6b1-4725-ae6d-b05666544756",
      "name": "busca_variavel_refresh_token_conta_azul",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        -640,
        680
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "Basic Auth Conta Azul"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "eb16e176-da39-4a64-9c1e-a9102ea291c7",
      "name": "busca_variavel_auth_conta_Azul",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        -420,
        680
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 8 * * *"
            }
          ]
        }
      },
      "id": "b3cd29ea-55f6-4702-beaa-ddda7160c316",
      "name": "8am",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -1040,
        680
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "Access Token Conta Azul"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "5824e9ea-1e8b-4c02-958e-2e900358142c",
      "name": "busca_variavel_access_token_conta_azul",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        620,
        780
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE variaveis_globais_n8n\nSET valor_variavel = CASE \n    WHEN id = 16 THEN '{{$json[\"id_token\"] }}'\n    WHEN id = 15 THEN '{{ $json[\"access_token\"] }}'\n    WHEN id = 13 THEN '{{ $json[\"refresh_token\"] }}'\nEND\nWHERE id IN (16, 15, 13);",
        "options": {}
      },
      "id": "b5575adb-4bca-4dff-8954-23379f16a593",
      "name": "atualiza_bd1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1800,
        500
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "Refresh Token Conta Azul"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "349ddcd6-6f7e-4432-a8f3-5acc82d326e9",
      "name": "busca_variavel_refresh_token_conta_azul1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        820,
        780
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE variaveis_globais_n8n\nSET valor_variavel = CASE \n    WHEN id = 16 THEN '{{$json[\"id_token\"] }}'\n    WHEN id = 15 THEN '{{ $json[\"access_token\"] }}'\n    WHEN id = 13 THEN '{{ $json[\"refresh_token\"] }}'\nEND\nWHERE id IN (16, 15, 13);",
        "options": {}
      },
      "id": "02b90f65-5021-40a0-945f-448f6bb7c9dc",
      "name": "atualiza_bd",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        0,
        680
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "c2ed465e-958e-4d5d-94b3-22521b7c7be0",
              "leftValue": "={{ String($json[\"error\"][\"status\"]) }}{{ String($json[\"error\"][\"message\"]) }}",
              "rightValue": "401",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d58cf72a-305a-4ac9-9214-ce3ff823ace3",
      "name": "erro_de_token",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1220,
        780
      ]
    },
    {
      "parameters": {},
      "id": "cdc0f47c-dc6d-406e-b08a-00368361833b",
      "name": "5s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1660,
        780
      ],
      "webhookId": "c61462fa-a43b-45a9-aa2d-8db69d110c8c"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1013c044-9f74-4629-950f-e57ffd82ed5d",
              "name": "tamanho_batching",
              "value": 50,
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "667674b0-338d-4cb8-a7c1-99b6afef25eb",
      "name": "tamanho_batching",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        -840,
        680
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "c6d49e8e-59e1-4cdf-abcf-4500c9d5ed15",
              "leftValue": "={{ $node[\"busca_itens_totais\"].json[\"itens_totais\"] }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fe48a7e5-067d-4ecc-88f5-a8b19e5c7a98",
      "name": "sem_itens",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1440,
        860
      ]
    },
    {
      "parameters": {
        "jsCode": "const totalItens = $node[\"busca_itens_totais\"].json[\"itens_totais\"];\nconst pageSize = $node[\"tamanho_batching\"].json[\"tamanho_batching\"];\n\nconst totalPaginas = Math.ceil(totalItens / pageSize);\n\nconst paginas = [];\nfor (let i = 1; i <= totalPaginas; i++) {\n  paginas.push({ pagina: i });\n}\n\nreturn paginas;"
      },
      "id": "8714088e-5998-4932-af9e-921caa87dbdb",
      "name": "define_batching",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1640,
        980
      ]
    },
    {
      "parameters": {
        "url": "https://api-v2.contaazul.com/v1/financeiro/eventos-financeiros/contas-a-receber/buscar",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "data_vencimento_de",
              "value": "={{ $node[\"loop\"].json[\"data_de\"] }}"
            },
            {
              "name": "data_vencimento_ate",
              "value": "={{ $node[\"loop\"].json[\"data_ate\"] }}"
            },
            {
              "name": "status",
              "value": "={{$node[\"loop\"].json[\"status\"] }}"
            },
            {
              "name": "pagina",
              "value": "1"
            },
            {
              "name": "tamanho_pagina",
              "value": "={{ $node[\"tamanho_batching\"].json[\"tamanho_batching\"] }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $node[\"busca_variavel_access_token_conta_azul\"].json[\"valor_variavel\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f196b746-3b48-428d-98ba-b98454173d1c",
      "name": "busca_itens_totais",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1020,
        780
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://auth.contaazul.com/oauth2/token",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ $node[\"busca_variavel_auth_conta_Azul\"].json[\"valor_variavel\"].trim() }}"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "refresh_token",
              "value": "={{ $node[\"busca_variavel_refresh_token_conta_azul1\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "grant_type",
              "value": "refresh_token"
            }
          ]
        },
        "options": {}
      },
      "id": "fc49668e-65ab-4657-ae8a-fb6e07f949bc",
      "name": "get_new_token1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1580,
        500
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "itens",
        "options": {}
      },
      "id": "13bb3f45-f96e-464b-a5b8-091c6692d4aa",
      "name": "Split Out1",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2760,
        280
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "d0801530-d595-467c-a88e-e2b17892741d",
      "name": "loop3",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        3020,
        280
      ]
    },
    {
      "parameters": {
        "queue": "cobranca_conta_azul_p2",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "durable": true
        }
      },
      "id": "d631c418-0898-4a28-b2d6-45555f99a0b0",
      "name": "entra_na_fila",
      "type": "n8n-nodes-base.rabbitmq",
      "typeVersion": 1,
      "position": [
        3500,
        380
      ],
      "credentials": {
        "rabbitmq": {
          "id": "gEWuEJrN8BnSAPqF",
          "name": "[RabbitMQ] - Fabr칤cio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api-v2.contaazul.com/v1/financeiro/eventos-financeiros/contas-a-receber/buscar",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "data_vencimento_de",
              "value": "={{ $node[\"chega_da_fila\"].json[\"content\"][\"data_vencimento_de\"]}}"
            },
            {
              "name": "data_vencimento_ate",
              "value": "={{ $node[\"chega_da_fila\"].json[\"content\"][\"data_vencimento_ate\"] }}"
            },
            {
              "name": "status",
              "value": "={{ $node[\"chega_da_fila\"].json[\"content\"][\"status\"] }}"
            },
            {
              "name": "pagina",
              "value": "={{ $node[\"chega_da_fila\"].json[\"content\"][\"pagina\"] }}"
            },
            {
              "name": "tamanho_pagina",
              "value": "={{ $node[\"chega_da_fila\"].json[\"content\"][\"tamanho_pagina\"] }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $node[\"chega_da_fila\"].json[\"content\"][\"access_token\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0f1ebb28-7977-4cee-acd7-c388e5f7c138",
      "name": "busca_contas2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2560,
        280
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "36a1c4e5-37d3-4e0e-b8d1-8f7050bad50c",
              "name": "nao_pago",
              "value": "={{ $node[\"loop3\"].json[\"nao_pago\"] }}",
              "type": "string"
            },
            {
              "id": "b8dfa8ba-6772-4be5-bd93-f535df0b844a",
              "name": "status_traduzido",
              "value": "={{ $node[\"loop3\"].json[\"status_traduzido\"] }}",
              "type": "string"
            },
            {
              "id": "1132be05-8293-4374-9d10-4bff75719929",
              "name": "pago",
              "value": "={{ $node[\"loop3\"].json[\"pago\"] }}",
              "type": "string"
            },
            {
              "id": "d1aadbb0-a76c-46d6-9332-d17c4947b265",
              "name": "data_alteracao",
              "value": "={{ $node[\"loop3\"].json[\"data_alteracao\"] }}",
              "type": "string"
            },
            {
              "id": "6e585d6d-6842-4314-9d4b-96fd1e73dcf4",
              "name": "data_alteracao",
              "value": "={{ $node[\"loop3\"].json[\"data_alteracao\"] }}",
              "type": "string"
            },
            {
              "id": "07b19af0-fac3-4cf7-8e53-2531ba7b8718",
              "name": "mensagem_tipo",
              "value": "={{ $node[\"chega_da_fila\"].json[\"content\"][\"mensagem_tipo\"] }}",
              "type": "string"
            },
            {
              "id": "4f633ecb-b249-44b5-83c7-ea247cf97a3c",
              "name": "cliente.id",
              "value": "={{  $node[\"loop3\"].json[\"cliente\"][\"id\"] }}",
              "type": "string"
            },
            {
              "id": "ef5d6035-f8df-4117-b9bf-da86f6d2e310",
              "name": "cliente.nome",
              "value": "={{  $node[\"loop3\"].json[\"cliente\"][\"nome\"] }}",
              "type": "string"
            },
            {
              "id": "fd3bbee2-2711-4ff6-b5f6-feff8544c317",
              "name": "data_vencimento",
              "value": "={{ $node[\"loop3\"].json[\"data_vencimento\"] }}",
              "type": "string"
            },
            {
              "id": "fa6a6bc3-8a39-4546-845a-b451b451dfba",
              "name": "descricao",
              "value": "={{ $node[\"loop3\"].json[\"descricao\"] }}",
              "type": "string"
            },
            {
              "id": "e889d6c1-de43-43c8-978c-4d4726009362",
              "name": "total",
              "value": "={{ $node[\"loop3\"].json[\"total\"] }}",
              "type": "string"
            },
            {
              "id": "c236a087-398a-4f2e-aa4e-a83bd31c339b",
              "name": "status",
              "value": "={{ $node[\"loop3\"].json[\"status\"] }}",
              "type": "string"
            },
            {
              "id": "ca46757a-313a-497d-bf44-ac4958e54779",
              "name": "id",
              "value": "={{ $node[\"loop3\"].json[\"id\"] }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "include": "selected",
        "options": {}
      },
      "id": "ee8d3eb6-3349-45bf-85b0-bac9fb6fc8de",
      "name": "dados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        3280,
        380
      ]
    },
    {
      "parameters": {
        "jsCode": "const hoje = $now.toISODate().split('T')[0];\nconst configs = [\n  { nome: '5 dias antes', data_de: $now.plus({ days: 5 }).toISODate().split('T')[0], data_ate: $now.plus({ days: 5 }).toISODate().split('T')[0], status: 'PENDING', mensagem_tipo: '5_antes' },\n  { nome: '2 dias antes', data_de: $now.plus({ days: 2 }).toISODate().split('T')[0], data_ate: $now.plus({ days: 2 }).toISODate().split('T')[0], status: 'PENDING', mensagem_tipo: '2_antes' },\n  { nome: '1 dia antes', data_de: $now.plus({ days: 1 }).toISODate().split('T')[0], data_ate: $now.plus({ days: 1 }).toISODate().split('T')[0], status: 'PENDING', mensagem_tipo: '1_antes' },\n  { nome: 'No dia', data_de: hoje, data_ate: hoje, status: 'PENDING', mensagem_tipo: 'no_dia' },\n  { nome: '1 dia atraso', data_de: $now.minus({ days: 1 }).toISODate().split('T')[0], data_ate: $now.minus({ days: 1 }).toISODate().split('T')[0], status: 'ATRASADO', mensagem_tipo: '1_atraso' },\n  { nome: '2 dias atraso', data_de: $now.minus({ days: 2 }).toISODate().split('T')[0], data_ate: $now.minus({ days: 2 }).toISODate().split('T')[0], status: 'ATRASADO', mensagem_tipo: '2_atraso' },\n  { nome: '3 dias atraso', data_de: $now.minus({ days: 3 }).toISODate().split('T')[0], data_ate: $now.minus({ days: 3 }).toISODate().split('T')[0], status: 'ATRASADO', mensagem_tipo: '3_atraso' },\n  { nome: '5 dias atraso', data_de: $now.minus({ days: 5 }).toISODate().split('T')[0], data_ate: $now.minus({ days: 5 }).toISODate().split('T')[0], status: 'ATRASADO', mensagem_tipo: '5_atraso' }\n];\nreturn configs.map(config => ({ json: config }));"
      },
      "id": "54fd20de-6c6e-4d76-b187-9b75be00be4a",
      "name": "define_datas",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        200,
        680
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://auth.contaazul.com/oauth2/token",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ $node[\"busca_variavel_auth_conta_Azul\"].json[\"valor_variavel\"].trim() }}"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "refresh_token",
              "value": "={{ $node[\"busca_variavel_refresh_token_conta_azul\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "grant_type",
              "value": "refresh_token"
            }
          ]
        },
        "options": {}
      },
      "id": "66f99d2f-661d-4113-82fc-b19afb45d075",
      "name": "get_new_token",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -200,
        680
      ]
    },
    {
      "parameters": {
        "amount": 20
      },
      "id": "64751f87-5dae-4e8c-b49b-6f6a72cbc1bb",
      "name": "20s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2020,
        500
      ],
      "webhookId": "f2918b4e-933c-463d-b838-d160622c38dd"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://webhookeditorhetznerfabricionunnes.automagicbots.com.br/webhook/aciona-automacao-envios-lembretes-conta-azul",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "dcae0458-58a7-4511-b3f2-867319c3c44b",
      "name": "aciona_automacao_envios",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1020,
        580
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "1QmOzOM2uRWpT8Xk",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "content": "### 游늷 Defina aqui a qtd de itens trazidos por \nvez (tamanho_batching) \nde devedores da conta azul. Ideal = 50",
        "width": 202.7459912321532,
        "color": 3
      },
      "id": "48b64de2-12f0-415d-943a-64f48a160092",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -900,
        500
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 J치 come칞a solicitando novo token  Conta Azul com validade de 1 hora, tempo suficiente para finalizar todo o processo e atualiza as informa칞칫es necess치rias na tabela de vari치veis globais referente a conta azul",
        "height": 80,
        "width": 779.4380469584223
      },
      "id": "1749339b-9526-440b-91c7-83620347a60f",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -680,
        500
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 O node define_datas define os per칤odos a buscar na api Conta Azul\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[\n  {\n    \"nome\": \"5 dias antes\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"PENDING\",\n    \"mensagem_tipo\": \"5_antes\"\n  },\n  {\n    \"nome\": \"2 dias antes\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"PENDING\",\n    \"mensagem_tipo\": \"2_antes\"\n  },\n  {\n    \"nome\": \"1 dia antes\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"PENDING\",\n    \"mensagem_tipo\": \"1_antes\"\n  },\n  {\n    \"nome\": \"No dia\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"PENDING\",\n    \"mensagem_tipo\": \"no_dia\"\n  },\n  {\n    \"nome\": \"1 dia atraso\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"ATRASADO\",\n    \"mensagem_tipo\": \"1_atraso\"\n  },\n  {\n    \"nome\": \"2 dias atraso\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"ATRASADO\",\n    \"mensagem_tipo\": \"2_atraso\"\n  },\n  {\n    \"nome\": \"3 dias atraso\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"ATRASADO\",\n    \"mensagem_tipo\": \"3_atraso\"\n  },\n  {\n    \"nome\": \"5 dias atraso\",\n    \"data_de\": \"xx\",\n    \"data_ate\": \"xx\",\n    \"status\": \"ATRASADO\",\n    \"mensagem_tipo\": \"5_atraso\"\n  }\n]",
        "height": 1200.1319247982838,
        "width": 244.4704810521412,
        "color": 6
      },
      "id": "989815bf-b967-4ee7-b333-8bcd83dbccc6",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        120,
        500
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 Aciona envio das mensagens na [PARTE 3](https://n8neditorhetznerfabricionunnes.automagicbots.com.br/workflow/4E4VLQ50ywCA8VY8)",
        "height": 84.79547810667788
      },
      "id": "d43be2b5-1e09-4903-b774-fcca77788c28",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        960,
        480
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 Renova o token se expirado e atualiza o bd pra continuar o processo de onde parou",
        "height": 80,
        "width": 423.2897231378064,
        "color": 5
      },
      "id": "509fb57b-b33b-468b-9f5d-9b587bb19fb8",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1580,
        400
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 S칩 busca o n칰mero de itens existentes",
        "height": 80,
        "color": 3
      },
      "id": "3ef3fa15-8868-46c7-bf5d-a01022bafd1c",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        960,
        940
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 Define quantas p치ginas ser칚o buscadas no total na api conta azul\n\nOu seja, divide totalItens por tamanho_batching que vc definiu no node tamanho_batching",
        "height": 210.6654519242718,
        "color": 4
      },
      "id": "ed6f6b22-b3da-44e9-a177-c15e7754ef9a",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1560,
        1140
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 Puxa o conjunto de contas a receber por conjunto de per칤odos definidos no node \ndefine_datas \n### e divide em itens 칰nicos pra processamento por loop3",
        "height": 167.51296112767795,
        "width": 433.1664051094924,
        "color": 5
      },
      "id": "10356ac5-e607-4977-8d42-ffc31f0879cc",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2480,
        460
      ]
    },
    {
      "parameters": {
        "content": "### 游늷 Estrutura dados e envia a fila na [PARTE 2](https://n8neditorhetznerfabricionunnes.automagicbots.com.br/workflow/GSnjgjfNHdIeJXt4) onde busca_pessoa, busca_payment_link, formata_dados, copy e registra_cobranca no bd table lembretes_enviados",
        "height": 141.09657437926887,
        "width": 347.291545251399,
        "color": 2
      },
      "id": "f09931df-6b91-4c83-b859-ef48c0406693",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        3260,
        580
      ]
    },
    {
      "parameters": {},
      "id": "9ae0a579-5163-4484-9c38-da87ffa71ce4",
      "name": "end",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        620,
        580
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "419fad62-d6e0-4b8e-9bcb-fe612272dbc6",
      "name": "loop",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        420,
        680
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "97724f88-3d96-4e60-a6d6-b40284747e69",
              "name": "data_vencimento_de",
              "value": "={{ $node[\"loop\"].json[\"data_de\"] }}",
              "type": "string"
            },
            {
              "id": "8373b00e-4700-4807-8a22-ac594e54a849",
              "name": "data_vencimento_ate",
              "value": "={{ $node[\"loop\"].json[\"data_ate\"] }}",
              "type": "string"
            },
            {
              "id": "3e2bf1f0-0293-4995-8ace-bc1a17146c4f",
              "name": "status",
              "value": "={{$node[\"loop\"].json[\"status\"] }}",
              "type": "string"
            },
            {
              "id": "83e2dfaf-be00-4d80-b593-ecec01c099b6",
              "name": "tamanho_pagina",
              "value": "={{ $node[\"tamanho_batching\"].json[\"tamanho_batching\"] }}",
              "type": "string"
            },
            {
              "id": "6d39e7ce-8725-4e1d-a70c-5a8eed4499a8",
              "name": "access_token",
              "value": "={{ $node[\"busca_variavel_access_token_conta_azul\"].json[\"valor_variavel\"] }}",
              "type": "string"
            },
            {
              "id": "4e47405e-02b7-4bb5-bc9a-f1c5dad8f4a6",
              "name": "mensagem_tipo",
              "value": "={{ $node[\"loop\"].json[\"mensagem_tipo\"] }}",
              "type": "string"
            },
            {
              "id": "1173477d-c0fd-4b8a-b96e-0413bc45b075",
              "name": "pagina",
              "value": "={{ $node[\"define_batching\"].json[\"pagina\"] }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "include": "selected",
        "options": {}
      },
      "id": "c06e68e4-b80b-4440-b8e4-cda693e1e133",
      "name": "dados1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        1840,
        980
      ]
    },
    {
      "parameters": {
        "queue": "cobranca_conta_azul",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "durable": true
        }
      },
      "id": "1986d98d-4a31-4bad-ba3a-9a3a64b90a02",
      "name": "entra_na_fila1",
      "type": "n8n-nodes-base.rabbitmq",
      "typeVersion": 1,
      "position": [
        2020,
        980
      ],
      "credentials": {
        "rabbitmq": {
          "id": "gEWuEJrN8BnSAPqF",
          "name": "[RabbitMQ] - Fabr칤cio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "queue": "cobranca_conta_azul",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "acknowledge": "executionFinishesSuccessfully",
          "jsonParseBody": "={{ true }}",
          "parallelMessages": 1
        }
      },
      "id": "c2148146-fc9d-457d-88e3-ae94bd5c8656",
      "name": "chega_da_fila",
      "type": "n8n-nodes-base.rabbitmqTrigger",
      "typeVersion": 1,
      "position": [
        2360,
        280
      ],
      "credentials": {
        "rabbitmq": {
          "id": "gEWuEJrN8BnSAPqF",
          "name": "[RabbitMQ] - Fabr칤cio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "content": "## 游늷 PARTE 1",
        "height": 1641.2720893858477,
        "width": 3359.8962812446925,
        "color": 7
      },
      "id": "aa4f1876-b8c7-4af0-b12f-df98b00557b0",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1100,
        140
      ]
    },
    {
      "parameters": {
        "content": "## 游늷 PARTE 2",
        "height": 636.7979972966464,
        "width": 1401.9775518681151,
        "color": 7
      },
      "id": "6ba9e431-8279-4994-b51a-b7eb781fdc2e",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2300,
        140
      ]
    },
    {
      "parameters": {},
      "id": "8d3b3326-3fb9-4f34-864b-d8d98b68409b",
      "name": "fim",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3280,
        220
      ]
    },
    {
      "parameters": {
        "amount": 120
      },
      "id": "41cee051-792d-4345-b78a-556b1eecc978",
      "name": "120s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        820,
        580
      ],
      "webhookId": "f2918b4e-933c-463d-b838-d160622c38dd"
    }
  ],
  "pinData": {
    "chega_da_fila": [
      {
        "json": {
          "fields": {
            "consumerTag": "amq.ctag-DnHvwu06eyDfRvHSin_I6A",
            "deliveryTag": 1,
            "redelivered": false,
            "exchange": "",
            "routingKey": "cobranca_conta_azul"
          },
          "properties": {
            "headers": {}
          },
          "content": {
            "data_vencimento_de": "2026-01-03",
            "data_vencimento_ate": "2026-01-03",
            "status": "PENDING",
            "tamanho_pagina": "50",
            "access_token": "eyJraWQiOiJUa1BRbWs0UlR3M3RuWlZXcDdEanBURFhcL2RTajNvMU5SckI0R3I3ZzFTMD0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyNTZjMTFjMS04NTMzLTQ5MTAtOGRkMC1kNzJkZmVlMjgyNjQiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuc2EtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3NhLWVhc3QtMV9WcDgzSjExd0EiLCJ2ZXJzaW9uIjoyLCJjbGllbnRfaWQiOiI3dmg2cHIwZWJudHNjcGRxcHVrMzM4aDBqZSIsIm9yaWdpbl9qdGkiOiJjMjIzNjQ1YS0yN2VkLTRhMDgtOTVlOC0yNGZiZmNkNmMwNzgiLCJldmVudF9pZCI6IjBjNzMxNTAzLWYzYWMtNDFjYy04MDhiLTdjMzc3MWQ4NTVkNiIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4gb3BlbmlkIHByb2ZpbGUiLCJhdXRoX3RpbWUiOjE3NjY1OTE4MjQsImV4cCI6MTc2NzAzNTQwNSwiaWF0IjoxNzY3MDMxODA1LCJqdGkiOiJiMjYzMzA0Zi04OWViLTQwYTUtYjAyNC0zMjY5ZmU4OTNjZWEiLCJ1c2VybmFtZSI6ImZhYnJpY2lvQHVuaXZlcnNpZGFkZXZlbmRhcy5jb20uYnIifQ.e_9FNUECveSFDAS-zQ9nQPA8gIExtuRUpxMCecTAaiHtdd3z0YEcZdvjq8oCzsXWeuPSBa3e6LOygS02iRee75WwuSwZh1poGHIYRFX-yZZqCqHphaXpsPG5YY2s4uEjXcIEQpdm9PomwwbcUGNix_f82fyP6iScmleSPlJTWnQjO-hZ3JY_E7gLE-tWyn2sfhU4ra4Jl3GDXXvQz7UBI7sevJl0JBhFRQ2sUXG2m-ZIoEujcKhR8u1wgo0iWeo1OFPosy5ocCkRScQ2WceQ9SXhNgsNJYWtFnheUBNHcqZPfefhp_Gi4kZ-_5VPpieCn6L9YCZ1yyIA6s0igJFx4Q",
            "mensagem_tipo": "5_antes",
            "pagina": "1"
          }
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "saveExecutionProgress": true,
    "saveManualExecutions": false,
    "callerPolicy": "workflowsFromSameOwner",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  },
  "staticData": {
    "node:8am": {
      "recurrencyRules": []
    }
  },
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-12-30T12:03:16.352Z",
  "versionId": "d418f42b-16ce-42bb-9d1a-a32860fd00f2"
}