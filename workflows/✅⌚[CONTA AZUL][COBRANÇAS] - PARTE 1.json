{
  "active": false,
  "connections": {
    "pagamento_pra_hoje": {
      "main": [
        [
          {
            "node": "entra_na_fila",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "proximos_2_dias",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "entra_na_fila": {
      "main": [
        [
          {
            "node": "separa_itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "entra_na_fila1": {
      "main": [
        [
          {
            "node": "separa_itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "proximos_2_dias": {
      "main": [
        [
          {
            "node": "entra_na_fila1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "separa_itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa_itens": {
      "main": [
        [
          {
            "node": "fim",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "busca_cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados_validados": {
      "main": [
        [
          {
            "node": "pagamento_pra_hoje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_cliente": {
      "main": [
        [
          {
            "node": "pessoa_juridica",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tratamento_de_dados": {
      "main": [
        [
          {
            "node": "dados_validados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pessoa_juridica": {
      "main": [
        [
          {
            "node": "tratamento_de_dados1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "tratamento_de_dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tratamento_de_dados1": {
      "main": [
        [
          {
            "node": "dados_validados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "9am": {
      "main": [
        [
          {
            "node": "soma_2dias",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_faturas": {
      "main": [
        [
          {
            "node": "separa_itens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_variavel_refresh_token_conta_azul": {
      "main": [
        [
          {
            "node": "busca_variavel_auth_conta_Azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_variavel_auth_conta_Azul": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking \"Test workflow\"": {
      "main": [
        [
          {
            "node": "busca_variavel_access_token_conta_azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_variavel_access_token_conta_azul": {
      "main": [
        [
          {
            "node": "busca_variavel_refresh_token_conta_azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "nao_e_erro_de_token": {
      "main": [
        [
          {
            "node": "end",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "erro_de_token1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "erro_de_token1": {
      "main": [
        [
          {
            "node": "new_refresh_token_conta_azul",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "buscar_titulos_a_receber",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "erro_de_token": {
      "main": [
        [
          {
            "node": "new_refresh_token_conta_azul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update_refresh_token1": {
      "main": [
        [
          {
            "node": "update_access_token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update_access_token": {
      "main": [
        [
          {
            "node": "update_id_token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "new_refresh_token_conta_azul": {
      "main": [
        [
          {
            "node": "update_refresh_token1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "buscar_titulos_a_receber": {
      "main": [
        [
          {
            "node": "erro_de_token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-22T14:20:48.530Z",
  "id": "Fml8iwoM2KDOZ80a",
  "meta": null,
  "name": "‚úÖ‚åö[CONTA AZUL][COBRAN√áAS] - PARTE 1",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a995bb1e-e8f3-45d2-8e7b-b67146c47cfd",
              "leftValue": "={{ $node[\"dados_validados\"].json[\"status_pagamento\"] }}",
              "rightValue": "PENDING",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "555f7f15-8b92-436b-815f-d42af409a6f6",
              "leftValue": "={{ $node[\"dados_validados\"].json[\"data_vencimento\"] }}",
              "rightValue": "={{ $now.toFormat('dd/MM/yyyy') }}",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8937059f-bce6-4309-a83a-98cdb5fed8c4",
      "name": "pagamento_pra_hoje",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        3036,
        1032
      ]
    },
    {
      "parameters": {
        "queue": "Cobran√ßas - No dia do vencimento",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "durable": true
        }
      },
      "id": "9511bca8-bd8a-49d3-b1a1-ba8cffba449b",
      "name": "entra_na_fila",
      "type": "n8n-nodes-base.rabbitmq",
      "typeVersion": 1,
      "position": [
        3244,
        904
      ]
    },
    {
      "parameters": {
        "queue": "Cobran√ßas - Dois dias antes do vencimento",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "durable": true
        }
      },
      "id": "bac86257-9071-4e22-8dc4-d1747827944c",
      "name": "entra_na_fila1",
      "type": "n8n-nodes-base.rabbitmq",
      "typeVersion": 1,
      "position": [
        3500,
        1032
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a995bb1e-e8f3-45d2-8e7b-b67146c47cfd",
              "leftValue": "={{ $node[\"dados_validados\"].json[\"status_pagamento\"] }}",
              "rightValue": "PENDING",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "555f7f15-8b92-436b-815f-d42af409a6f6",
              "leftValue": "={{ $node[\"dados_validados\"].json[\"data_vencimento\"] }}",
              "rightValue": "={{ $node[\"soma_2dias\"].json[\"formattedDate\"].slice(8,10) }}/{{ $node[\"soma_2dias\"].json[\"formattedDate\"].slice(5,7) }}/{{ $node[\"soma_2dias\"].json[\"formattedDate\"].slice(0,4) }}",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8fb3fea6-e87b-4fdc-b958-8a9c3abe2227",
      "name": "proximos_2_dias",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        3260,
        1176
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "950f87d5-3364-4765-908f-f1a3c3a4302c",
      "name": "separa_itens",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1980,
        792
      ]
    },
    {
      "parameters": {},
      "id": "f7ebbabf-0fae-44c3-936a-28a1758d7c7a",
      "name": "fim",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2220,
        680
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "059ab691-ffe6-48c8-901e-cdfecee11302",
              "name": "Nome do Cliente",
              "value": "={{ $json[\"Nome do Cliente\"] }}",
              "type": "string"
            },
            {
              "id": "9ee4df91-0eb5-4a19-a4b7-8e08a96f5d30",
              "name": "E-mail do Cliente",
              "value": "={{ $json[\"E-mail do Cliente\"] }}",
              "type": "string"
            },
            {
              "id": "bb957508-da24-416e-908b-05212530eedd",
              "name": "Telefone do Cliente - Formato BC",
              "value": "={{ $json[\"Telefone do Cliente - Formato BC\"] }}",
              "type": "string"
            },
            {
              "id": "4f93602a-178c-4a9f-adeb-ce9246c58ac6",
              "name": "Telefone do Cliente - Formato Z-API",
              "value": "={{ $json[\"Telefone do Cliente - Formato Z-API\"] }}",
              "type": "string"
            },
            {
              "id": "7e17e166-562b-4007-b730-4eb63ac79daa",
              "name": "CPF/CNPJ",
              "value": "={{ $json[\"CPF/CNPJ\"] }}",
              "type": "string"
            },
            {
              "id": "cc0f25b8-070f-407b-92db-bb6251bad398",
              "name": "endereco_completo",
              "value": "={{ $json[\"endereco_completo\"] }}",
              "type": "string"
            },
            {
              "id": "9ba8bc89-e7ae-4dea-93bf-2a28b7627cb4",
              "name": "id_conta_azul",
              "value": "={{ $json[\"id_conta_azul\"] }}",
              "type": "string"
            },
            {
              "id": "4bfc5a59-be7b-4fcb-9084-6661923a4e99",
              "name": "nome_da_companhia",
              "value": "={{ $json[\"nome_da_companhia\"] }}",
              "type": "string"
            },
            {
              "id": "67771b9a-e3e1-49da-9b3b-c3058b9bf218",
              "name": "vendedor",
              "value": "={{ $json[\"vendedor\"] }}",
              "type": "string"
            },
            {
              "id": "f6cfcd46-69f0-466f-8133-b5e88192d203",
              "name": "valor_da_cobranca",
              "value": "={{ $json[\"valor_da_cobranca\"] }}",
              "type": "string"
            },
            {
              "id": "5fb27a5b-b7c2-4953-a89c-26518ca0d699",
              "name": "data_vencimento",
              "value": "={{ $json[\"data_vencimento\"] }}",
              "type": "string"
            },
            {
              "id": "32ab7fd2-3773-44d0-afe6-183953c0b6df",
              "name": "id_fatura",
              "value": "={{ $json[\"id_fatura\"] }}",
              "type": "string"
            },
            {
              "id": "86e36cf7-004c-4cf8-a48b-be1353038062",
              "name": "nome_servico",
              "value": "={{ $json[\"nome_servico\"] }}",
              "type": "string"
            },
            {
              "id": "5e9a9eed-e1e0-4abd-a0c4-3587c858209e",
              "name": "status_pagamento",
              "value": "={{ $json[\"status\"] }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "include": "selected",
        "options": {}
      },
      "id": "5b5cc6a1-9bf4-47c0-9cf6-c58eac6c4809",
      "name": "dados_validados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        2844,
        840
      ]
    },
    {
      "parameters": {
        "url": "=https://api.contaazul.com/v1/customers/{{ $node[\"separa_itens\"].json[\"customer_id\"] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $node[\"refresh_token\"].json[\"access_token\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c50e5c30-c41a-450a-b3ce-c9c90bfb2385",
      "name": "busca_cliente",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2220,
        856
      ],
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "///////////////////////// FUN√á√ïES /////////////////////////\n\n//FORMATAR TELEFONE\nfunction formatarTelefone(telefone) {\n  if (telefone === null || telefone.trim() === '') {\n    return '';\n  }\n\n  const telefoneLimpo = telefone.replace(/[^\\d]/g, '');\n\n  let ddi;\n  let ddd;\n  let telefoneFormatado;\n\n  if (telefoneLimpo.startsWith('55')) {\n    ddi = telefoneLimpo.slice(0, 2);\n    ddd = telefoneLimpo.slice(2, 4);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  } else {\n    ddi = '55';\n    ddd = telefoneLimpo.slice(0, 2);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  }\n\n  return telefoneFormatado;\n}\n\n//FORMATAR NOME\nfunction formatarNome(nome) {\n  if (nome) {\n    const palavras = nome.trim().split(/\\s+/);\n\n    const palavrasMinusculas = ['de', 'dos', 'da', 'e', 'do', 'das', 'di', 'du', 'o', 'a', 'u'];\n\n    for (let i = 0; i < palavras.length; i++) {\n      const palavraAtual = palavras[i].toLowerCase();\n      if (i === 0 || i === palavras.length - 1 || !palavrasMinusculas.includes(palavraAtual)) {\n        palavras[i] = palavraAtual.charAt(0).toUpperCase() + palavraAtual.slice(1);\n      } else {\n        palavras[i] = palavraAtual;\n      }\n    }\n\n    return palavras.join(\" \");\n  }\n  return '';\n}\n\n//FORMATAR DOCUMENTO\nfunction formatarCPForCNPJ(valor) {\n  if (!valor) return \"\";\n\n  const numeros = valor.replace(/\\D/g, '');\n\n  if (numeros.length === 11) {\n    return numeros.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, \"$1.$2.$3-$4\");\n  } else if (numeros.length === 14) {\n    return numeros.replace(/(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})/, \"$1.$2.$3/$4-$5\");\n  } else {\n    return valor;\n  }\n}\n\n//FORMATAR ENDERE√áO\nconst formatAddress = (address) => {\n    let formattedAddress = '';\n\n    if (address && address.street) {\n        formattedAddress += address.street;\n    }\n\n    if (address && address.number) {\n        formattedAddress += `, ${address.number}`;\n    }\n\n    if (address && address.complement) {\n        formattedAddress += ` - ${address.complement}`;\n    }\n\n    if (address && address.zip_code) {\n        formattedAddress += `, ${address.zip_code}`;\n    }\n\n    if (address && address.neighborhood) {\n        formattedAddress += `, ${address.neighborhood}`;\n    }\n\n    if (address && address.city && address.city.name) {\n        formattedAddress += `, ${address.city.name}`;\n    }\n\n    if (address && address.state && address.state.name) {\n        formattedAddress += ` - ${address.state.name}`;\n    }\n\n    return formattedAddress.trim();\n};\n\n///////////////////////// VARI√ÅVEIS /////////////////////////\n\nconst cliente = $node[\"busca_cliente\"].json;\nconst nome = formatarNome(cliente[\"name\"]) || '';\nconst telefone = formatarTelefone(cliente[\"mobile_phone\"] || cliente[\"business_phone\"]) || '';\nconst CPF_CNPJ = formatarCPForCNPJ(cliente[\"document\"]) || '';\nconst endereco = formatAddress(cliente[\"address\"]) || \"\";\nconst email = cliente[\"email\"] || '';\nconst id_conta_azul = cliente[\"id\"] || \"\";\nconst companhia = cliente[\"company_name\"] || \"\";\nconst vendedor = $node[\"separa_itens\"].json[\"seller\"] && $node[\"separa_itens\"].json[\"seller\"][\"name\"] ? $node[\"separa_itens\"].json[\"seller\"][\"name\"] : \"\";\nconst valor_da_cobranca = $node[\"separa_itens\"].json[\"payment\"] && $node[\"separa_itens\"].json[\"payment\"][\"installments\"] && $node[\"separa_itens\"].json[\"payment\"][\"installments\"][0] ? $node[\"separa_itens\"].json[\"payment\"][\"installments\"][0][\"value\"] || \"\" : \"\";\nconst data_vencimento = $node[\"separa_itens\"].json[\"payment\"] && $node[\"separa_itens\"].json[\"payment\"][\"installments\"] && $node[\"separa_itens\"].json[\"payment\"][\"installments\"][0] ? $node[\"separa_itens\"].json[\"payment\"][\"installments\"][0][\"due_date\"].split(\"T\")[0].split(\"-\").reverse().join(\"/\") || \"\" : \"\";\nconst id_fatura = $node[\"separa_itens\"].json[\"id\"] || \"\";\nconst nome_servico = $node[\"separa_itens\"].json[\"notes\"] || \"\";\nconst status = $node[\"separa_itens\"].json[\"status\"] || \"\";\n\nreturn {\n  \"Nome do Cliente\": nome,\n  \"E-mail do Cliente\": email,\n  \"Telefone do Cliente - Formato BC\": telefone,\n  \"Telefone do Cliente - Formato Z-API\": telefone,\n  \"CPF/CNPJ\": CPF_CNPJ,\n  \"endereco_completo\": endereco,\n  \"id_conta_azul\": id_conta_azul,\n  \"nome_da_companhia\": companhia,\n  vendedor,\n  valor_da_cobranca,\n  data_vencimento,\n  id_fatura,\n  nome_servico,\n  status\n};"
      },
      "id": "d08793a0-94a8-46af-9a51-0437c8e6b651",
      "name": "tratamento_de_dados",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2620,
        984
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "5f0467fa-9779-42f2-948f-797923d153d5",
              "leftValue": "={{ $node[\"busca_cliente\"].json[\"document\"].match(/^(\\d{2}\\.?\\d{3}\\.?\\d{3}\\/?\\d{4}-?\\d{2})$/) !== null }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "50262353-94b3-4a67-a0e7-d662d385dd5c",
      "name": "pessoa_juridica",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2396,
        856
      ]
    },
    {
      "parameters": {
        "jsCode": "///////////////////////// FUN√á√ïES /////////////////////////\n\n//FORMATAR TELEFONE\nfunction formatarTelefone(telefone) {\n  if (telefone === null || telefone.trim() === '') {\n    return '';\n  }\n\n  const telefoneLimpo = telefone.replace(/[^\\d]/g, '');\n\n  let ddi;\n  let ddd;\n  let telefoneFormatado;\n\n  if (telefoneLimpo.startsWith('55')) {\n    ddi = telefoneLimpo.slice(0, 2);\n    ddd = telefoneLimpo.slice(2, 4);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  } else {\n    ddi = '55';\n    ddd = telefoneLimpo.slice(0, 2);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  }\n\n  return telefoneFormatado;\n}\n\n//FORMATAR NOME\nfunction formatarNome(nome) {\n  if (nome) {\n    const palavras = nome.trim().split(/\\s+/);\n\n    const palavrasMinusculas = ['de', 'dos', 'da', 'e', 'do', 'das', 'di', 'du', 'o', 'a', 'u'];\n\n    for (let i = 0; i < palavras.length; i++) {\n      const palavraAtual = palavras[i].toLowerCase();\n      if (i === 0 || i === palavras.length - 1 || !palavrasMinusculas.includes(palavraAtual)) {\n        palavras[i] = palavraAtual.charAt(0).toUpperCase() + palavraAtual.slice(1);\n      } else {\n        palavras[i] = palavraAtual;\n      }\n    }\n\n    return palavras.join(\" \");\n  }\n  return '';\n}\n\n//FORMATAR DOCUMENTO\nfunction formatarCPForCNPJ(valor) {\n  if (!valor) return \"\";\n\n  const numeros = valor.replace(/\\D/g, '');\n\n  if (numeros.length === 11) {\n    return numeros.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, \"$1.$2.$3-$4\");\n  } else if (numeros.length === 14) {\n    return numeros.replace(/(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})/, \"$1.$2.$3/$4-$5\");\n  } else {\n    return valor;\n  }\n}\n\n//FORMATAR ENDERE√áO\nconst formatAddress = (address) => {\n    let formattedAddress = '';\n\n    if (address.street) {\n        formattedAddress += address.street;\n    }\n\n    if (address.number) {\n        formattedAddress += `, ${address.number}`;\n    }\n\n    if (address.complement) {\n        formattedAddress += ` - ${address.complement}`;\n    }\n\n    if (address.zip_code) {\n        formattedAddress += `, ${address.zip_code}`;\n    }\n\n    if (address.neighborhood) {\n        formattedAddress += `, ${address.neighborhood}`;\n    }\n\n    if (address.city && address.city.name) {\n        formattedAddress += `, ${address.city.name}`;\n    }\n\n    if (address.state && address.state.name) {\n        formattedAddress += ` - ${address.state.name}`;\n    }\n\n    return formattedAddress.trim();\n};\n\n///////////////////////// VARI√ÅVEIS /////////////////////////\n\nconst nome = formatarNome($node[\"busca_cliente\"].json[\"name\"]) || '';\nconst cliente = $node[\"busca_cliente\"].json;\nconst telefone = formatarTelefone($node[\"busca_cliente\"].json[\"mobile_phone\"] || $node[\"busca_cliente\"].json[\"business_phone\"]) || '';\nconst CPF_CNPJ = formatarCPForCNPJ($node[\"busca_cliente\"].json[\"document\"]) || '';\nconst endereco = formatAddress($node[\"busca_cliente\"].json[\"address\"]) || \"\";\nconst email = $node[\"busca_cliente\"].json[\"email\"] || '';\nconst isEmailValid = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\nconst id_conta_azul = $node[\"busca_cliente\"].json[\"id\"] || \"\";\nconst companhia = $node[\"busca_cliente\"].json[\"company_name\"] || \"\";\nconst vendedor = $node[\"separa_itens\"].json[\"seller\"][\"name\"] || \"\";\nconst valor_da_cobranca = $node[\"separa_itens\"].json[\"total\"] || \"\";\nconst data_vencimento = $node[\"separa_itens\"].json[\"emission\"].split(\"T\")[0].split(\"-\").reverse().join(\"/\") || \"\";\nconst id_fatura = $node[\"separa_itens\"].json[\"id\"] || \"\";\nconst nome_servico = $node[\"separa_itens\"].json[\"notes\"] || \"\";\nconst status = $node[\"separa_itens\"].json[\"status\"] || \"\";\n\nreturn {\n  \"Nome do Cliente\": nome,\n  \"E-mail do Cliente\": email,\n  \"Telefone do Cliente - Formato BC\": telefone,\n  \"Telefone do Cliente - Formato Z-API\": telefone,\n  \"CPF/CNPJ\": CPF_CNPJ,\n  \"endereco_completo\": endereco,\n  \"id_conta_azul\": id_conta_azul,\n  \"nome_da_companhia\": companhia,\n  vendedor,\n  valor_da_cobranca,\n  data_vencimento,\n  id_fatura,\n  nome_servico,\n  status\n};\n"
      },
      "id": "66bc7ae3-e60c-47cc-812e-6ce60da0cc4d",
      "name": "tratamento_de_dados1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2604,
        744
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a995bb1e-e8f3-45d2-8e7b-b67146c47cfd",
              "leftValue": "={{ $node[\"dados_validados\"].json[\"status_pagamento\"] }}",
              "rightValue": "PENDING",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "555f7f15-8b92-436b-815f-d42af409a6f6",
              "leftValue": "={{ $node[\"dados_validados\"].json[\"data_vencimento\"] }}",
              "rightValue": "={{ $node[\"soma_2dias\"].json[\"formattedDate\"].slice(8,10) }}/{{ $node[\"soma_2dias\"].json[\"formattedDate\"].slice(5,7) }}/{{ $node[\"soma_2dias\"].json[\"formattedDate\"].slice(0,4) }}",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ac3f6eed-aad0-4a22-b515-6456d3f96f7a",
      "name": "proximos_2_dias1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1404,
        1656
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://auth.contaazul.com/oauth2/token",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Basic N3ZuZmNzbTVzcDVlbTEyNjdicjdyNWp0cmc6YmloZGZra3ZqcDIwM2ZhNGNsNGhsZm0zcGZ2ZmVqMG1xaGdydHI3ODNkYmxvOTc5MjQy"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "grant_type",
              "value": "refresh_token"
            },
            {
              "name": "refresh_token",
              "value": "REFRESH_TOKEN_GERADO"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "fbc1cdfa-4467-4ddf-8066-91be9785e67a",
      "name": "busca_cliente1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        860,
        1500
      ],
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "https://api-v2.contaazul.com/v1/categorias",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer eyJraWQiOiJUa1BRbWs0UlR3M3RuWlZXcDdEanBURFhcL2RTajNvMU5SckI0R3I3ZzFTMD0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJjMTIxNDdlNS1mY2U5LTRmOTQtODY5Yy04Njk1ODk3ZGEzZjUiLCJkZXZpY2Vfa2V5Ijoic2EtZWFzdC0xXzQ1YmYxNmEwLWVhN2ItNDlmMS05MzVlLTczNWRhZjhlYzUyMSIsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC5zYS1lYXN0LTEuYW1hem9uYXdzLmNvbVwvc2EtZWFzdC0xX1ZwODNKMTF3QSIsImNsaWVudF9pZCI6Ijd2bmZjc201c3A1ZW0xMjY3YnI3cjVqdHJnIiwib3JpZ2luX2p0aSI6IjgyNDBjZGYxLTYwMTQtNDJlMi04ODE5LTJiZmY3ZmY4ZDY2NCIsImV2ZW50X2lkIjoiYTViZDdhMGMtYzE0ZC00MDgyLTliMjItYTllNjZhZjA1MDI2IiwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJhd3MuY29nbml0by5zaWduaW4udXNlci5hZG1pbiIsImF1dGhfdGltZSI6MTc2NjQ0MzQyMiwiZXhwIjoxNzY2NDQ3MDIyLCJpYXQiOjE3NjY0NDM0MjIsImp0aSI6IjVjYzA4ODk3LWQ1ODItNGYzNy05ZDAyLTk2MTljYzkwZWMwYiIsInVzZXJuYW1lIjoiNDhjN2VhMTktNDcwMC00Yjc2LWJkYjItM2U0ZmJlNTUwMzA4QGRldnBvcnRhbC5jb20ifQ.uyDdAUtm3Q6Z82bPFwOcagiQbReiqOdU1eY2UgissOB1uy0Bse3fge8AUcAq_IBwhZ9a-Frp1TECqXqVa40e09EzZYR2QY8GxgZB7jBHnAA78wrb3wd0sPVXMeE4xMuR96S94vaX9JkqgO6LuoeSYn0K-Otu2_6U8A9h2hU8w_AFAdQ-VtACIbbSc7kwksfjQSRC9S4hDIRCKdRWwnpCWdDBwfPU-1SJILcghIMAO9dA_X3RrdMDvJwNH1SWRVpw1n5xX1IGPbWIBwNHDFeVP3OzFUEVG1_R4aM2-HnNp0CYTTeghK7yYXT6xi-w5lpoWSihuqag_7r1yVw-XgVPhw"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "74b6c0ab-755a-4d7d-aa9b-0f24c6396451",
      "name": "busca_cliente2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1196,
        1592
      ],
      "alwaysOutputData": true,
      "credentials": {
        "oAuth2Api": {
          "id": "owcSGNzMlb0bbSeC",
          "name": "[Conta Azul][2] - Universidade de Vendas"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "https://api-v2.contaazul.com/v1/sales",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "customer_id",
              "value": "49b5922b-a63e-4a40-b345-42ddd82b4924"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer h8Oy77tweYZxf2NMNhzxWA1iNU9F99Ex"
            }
          ]
        },
        "options": {}
      },
      "id": "418bc8e6-d2f9-4574-ae9e-9e88ebeb77f2",
      "name": "busca_faturas1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -20,
        260
      ],
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 9
            }
          ]
        }
      },
      "id": "1dcea66e-3e92-44fe-9b83-0dad3560608e",
      "name": "9am",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -1196,
        1320
      ]
    },
    {
      "parameters": {
        "url": "https://api.contaazul.com/v1/sales?due_date=2024-04-25&status=PENDING",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{$node[\"refresh_token1\"].json[\"access_token\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "5c648b18-9b8f-4c71-90cb-a685f707bfdb",
      "name": "busca_faturas",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2220,
        1220
      ],
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setDate(today.getDate() + 2);\nconst year = today.getFullYear();\nconst month = String(today.getMonth() + 1).padStart(2, '0');\nconst day = String(today.getDate()).padStart(2, '0');\nconst formattedDate = `${year}-${month}-${day}`;\n\nconst today1 = new Date();\ntoday1.setDate(today1.getDate() - 30); // Aqui corrigimos para usar today1\nconst year1 = today1.getFullYear(); // Aqui corrigimos para usar today1\nconst month1 = String(today1.getMonth() + 1).padStart(2, '0'); // Aqui corrigimos para usar today1\nconst day1 = String(today1.getDate()).padStart(2, '0'); // Aqui corrigimos para usar today1\nconst formattedDate1 = `${year1}-${month1}-${day1}`; // Aqui corrigimos para usar today1\n\nreturn [{ formattedDate, formattedDate1 }];\n"
      },
      "id": "80f48cd8-4eb8-42e0-a0e5-2e9f06f2f9cd",
      "name": "soma_2dias",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1020,
        1320
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://auth.contaazul.com/oauth2/token",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ $node[\"get_client\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "refresh_token",
              "value": "={{ $node[\"get_refresh_token1\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "grant_type",
              "value": "refresh_token"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "15cb43d4-0209-44ad-b00b-b5054fa2cfdf",
      "name": "refresh_token2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1240,
        260
      ],
      "credentials": {
        "oAuth2Api": {
          "id": "rPMcxfmZaXUiOcP8",
          "name": "[Conta Azul] - Universidade de Vendas"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api-v2.contaazul.com/v1/categorias",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "8fde8c73-e012-45bc-b1bd-b33e492f4fb8",
      "name": "HTTP Request1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1600,
        240
      ],
      "credentials": {
        "oAuth2Api": {
          "id": "owcSGNzMlb0bbSeC",
          "name": "[Conta Azul][2] - Universidade de Vendas"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a995bb1e-e8f3-45d2-8e7b-b67146c47cfd",
              "leftValue": "={{ $json[\"status\"] }}",
              "rightValue": "PENDING",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "69978a92-ec4c-47e3-b2c1-b46b244d14c6",
              "leftValue": "={{ $json[\"payment\"][\"installments\"][\"0\"][\"status\"] }}",
              "rightValue": "PENDING",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "4b184d1a-b769-43ea-b62a-bbc97c29319c",
      "name": "pagamento_pra_hoje1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1516,
        1496
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "163445be-343b-44d9-ba9d-6c6649720324",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1180,
        1300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.contaazul.com/oauth2/token",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Basic BASE64(54es0dort4j7sr5teldrie2kc4:1vr7dqlt76hcfom9c7s9a1lilbvndip4j9gokqnhcf9ip36cj080)"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "code",
              "value": "c1ad084d-2bce-4437-8cf4-8ee3887ec3c8"
            },
            {
              "name": "grant_type",
              "value": "authorization_code"
            },
            {
              "name": "redirect_uri",
              "value": "https://n8neditorhetznerfabricionunnes.automagicbots.com.br/rest/oauth2-credential/callback"
            }
          ]
        },
        "options": {}
      },
      "id": "cf57cd4d-7cbe-479a-a9a1-fc0f06c44839",
      "name": "HTTP Request2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        860,
        1700
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "Refresh Token Conta Azul"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "95d51795-ea70-459c-a1b1-16e4aabeeac0",
      "name": "busca_variavel_refresh_token_conta_azul",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        -1000,
        840
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "Basic Auth Conta Azul"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "03a867af-3ab7-417b-a1b2-4fa81896cd07",
      "name": "busca_variavel_auth_conta_Azul",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        -780,
        840
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {},
      "id": "feb57ad5-f4f1-47c7-aedf-0cc633f054ae",
      "name": "When clicking \"Test workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1460,
        840
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "Access Token Conta Azul"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "85879ea6-bece-4849-9afb-bf101855824f",
      "name": "busca_variavel_access_token_conta_azul",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        -1240,
        840
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {},
      "id": "6593b6e9-5a2c-4e66-85b7-5cd678e1aebb",
      "name": "end",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        620,
        380
      ]
    },
    {
      "parameters": {
        "content": "# üìå AUTH INICIAL CONTA AZUL\n\n## 1. CRIA APLICA√á√ÉO EM: \n`` https://developers-portal.contaazul.com/#/``\n## 2. GERA CODE DE AUTORIZA√á√ÉO COM:\n``\nhttps://auth.contaazul.com/login?response_type=code&client_id={client_id}&redirect_uri={sua-url-de-calback-n8n}&state=ESTADO&scope=openid+profile+aws.cognito.signin.user.admin\n``\n\n## 3. TROQUE O CODE PELO TOKEN COM (M√âTODO POST):\n``\ncurl --location 'https://auth.contaazul.com/oauth2/token' \\\n--header 'Authorization: Basic BASE64(SEU_CLIENT_ID:SEU_CLIENT_SECRET)' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'code=CODIGO_AUTORIZACAO' \\\n--data-urlencode 'grant_type=authorization_code' \\\n--data-urlencode 'redirect_uri=SUA_URL_REDIRECIONAMENTO'\n``\n\n## 4. RENOVE O TOKEN COM:\n``\ncurl --location 'https://auth.contaazul.com/oauth2/token' \\\n--header 'Authorization: Basic BASE64(SEU_CLIENT_ID:SEU_CLIENT_SECRET)' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'refresh_token=REFRESH_TOKEN_GERADO' \\\n--data-urlencode 'grant_type=refresh_token'\n``",
        "height": 581.9710482284947,
        "width": 641.5680723053924,
        "color": 5
      },
      "id": "eb3a9fa7-e73a-4909-ab61-c4ed914bfa1d",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2020,
        1360
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://auth.contaazul.com/oauth2/token",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ $node[\"busca_variavel_auth_conta_Azul\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "id": "e1f6b4b8-10ec-4d85-b309-53cabfc5cc6d",
      "name": "replace_code_to_token_conta_azul",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -820,
        1340
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "c2ed465e-958e-4d5d-94b3-22521b7c7be0",
              "leftValue": "={{ $json[\"error\"][\"message\"] }}",
              "rightValue": "401",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "ignoreCase": true
        }
      },
      "id": "3282638a-2174-4a85-a68e-adbc8ff1bd17",
      "name": "nao_e_erro_de_token",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        400,
        180
      ]
    },
    {
      "parameters": {
        "url": "https://api-v2.contaazul.com/v1/pessoas",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "pagina",
              "value": "1"
            },
            {
              "name": "tamanho_pagina",
              "value": "10"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $node[\"busca_variavel_access_token_conta_azul\"].json[\"valor_variavel\"] }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "f6292279-c4d1-422d-8512-2a5688929fb1",
      "name": "HTTP Request3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -540,
        840
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "c2ed465e-958e-4d5d-94b3-22521b7c7be0",
              "leftValue": "={{ $json[\"statusCode\"] }}",
              "rightValue": 401,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "ignoreCase": true
        }
      },
      "id": "9a68f1dc-c207-4f81-b07f-3b2532dd779b",
      "name": "erro_de_token1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -340,
        840
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "c2ed465e-958e-4d5d-94b3-22521b7c7be0",
              "leftValue": "={{ $json[\"error\"][\"status\"] }}",
              "rightValue": 401,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "dd9cc9d3-1b2d-4852-8681-75bd23ec80cb",
      "name": "erro_de_token",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        120,
        920
      ]
    },
    {
      "parameters": {
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "id",
        "valueToMatchOn": "15",
        "valuesToSend": {
          "values": [
            {
              "column": "valor_variavel",
              "value": "={{ $node[\"new_refresh_token_conta_azul\"].json[\"access_token\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f4e2e23f-2666-404e-b9dd-7e6fcc0ae5cc",
      "name": "update_access_token",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        740,
        780
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "id",
        "valueToMatchOn": "13",
        "valuesToSend": {
          "values": [
            {
              "column": "valor_variavel",
              "value": "={{ $node[\"new_refresh_token_conta_azul\"].json[\"refresh_token\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f9b94de3-2d90-460a-838a-ce4af085d8fc",
      "name": "update_refresh_token1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        540,
        780
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "id",
        "valueToMatchOn": "16",
        "valuesToSend": {
          "values": [
            {
              "column": "valor_variavel",
              "value": "={{ $node[\"new_refresh_token_conta_azul\"].json[\"id_token\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0a2d0621-3c53-41a3-8635-08e396849f11",
      "name": "update_id_token",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.3,
      "position": [
        940,
        780
      ],
      "credentials": {
        "mySql": {
          "id": "PfzfhyuSKTUfroef",
          "name": "[MySQL] - Fabricio Nunnes"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://auth.contaazul.com/oauth2/token",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ $node[\"busca_variavel_auth_conta_Azul\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "refresh_token",
              "value": "={{ $node[\"busca_variavel_refresh_token_conta_azul\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "grant_type",
              "value": "refresh_token"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "78cce17d-6ed6-4f00-8739-86233df18315",
      "name": "new_refresh_token_conta_azul",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        340,
        780
      ]
    },
    {
      "parameters": {
        "url": "https://api.contaazul.com/v1/financeiro/eventos-financeiros/contas-a-receber/parcela/filtro",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $node[\"busca_variavel_access_token_conta_azul\"].json[\"valor_variavel\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "data_vencimento_de",
              "value": "2026-12-23"
            },
            {
              "name": "data_vencimento_ate",
              "value": "2025-12-31"
            },
            {
              "name": "situacao",
              "value": "EM_ABERTO"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "d23986ae-7e6b-40e6-b12e-7b2176794fcb",
      "name": "buscar_titulos_a_receber",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -100,
        920
      ],
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {
    "busca_faturas": [
      {
        "json": {
          "error": {
            "message": "401 - \"{\\\"error_description\\\":\\\"The access token is invalid or has expired\\\",\\\"error\\\":\\\"invalid_token\\\"}\\n\"",
            "name": "AxiosError",
            "stack": "AxiosError: Request failed with status code 401\n    at settle (/usr/local/lib/node_modules/n8n/node_modules/axios/lib/core/settle.js:19:12)\n    at RedirectableRequest.handleResponse (/usr/local/lib/node_modules/n8n/node_modules/axios/lib/adapters/http.js:537:9)\n    at RedirectableRequest.emit (node:events:529:35)\n    at RedirectableRequest.emit (node:domain:489:12)\n    at RedirectableRequest._processResponse (/usr/local/lib/node_modules/n8n/node_modules/follow-redirects/index.js:398:10)\n    at ClientRequest.RedirectableRequest._onNativeResponse (/usr/local/lib/node_modules/n8n/node_modules/follow-redirects/index.js:91:12)\n    at Object.onceWrapper (node:events:632:26)\n    at ClientRequest.emit (node:events:517:28)\n    at ClientRequest.emit (node:domain:489:12)\n    at HTTPParser.parserOnIncomingClient [as onIncoming] (node:_http_client:700:27)\n    at Axios.request (/usr/local/lib/node_modules/n8n/node_modules/axios/lib/core/Axios.js:45:41)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at requestFn (/usr/local/lib/node_modules/n8n/node_modules/n8n-core/dist/NodeExecuteFunctions.js:567:33)\n    at proxyRequestToAxios (/usr/local/lib/node_modules/n8n/node_modules/n8n-core/dist/NodeExecuteFunctions.js:570:26)\n    at Object.request (/usr/local/lib/node_modules/n8n/node_modules/n8n-core/dist/NodeExecuteFunctions.js:1986:50)",
            "code": "ERR_BAD_REQUEST",
            "status": 401
          }
        }
      }
    ],
    "HTTP Request1": [
      {
        "json": {
          "body": {
            "itens_totais": 123,
            "itens": [
              {
                "id": "a263de99-e55f-40b3-a691-96ac2b713f35",
                "versao": 0,
                "nome": "13¬∫ Sal√°rio - 1¬™ Parcela",
                "categoria_pai": "54580768-11ae-4d32-a8e4-7cecc4b08d9b",
                "tipo": "DESPESA",
                "entrada_dre": "DESPESAS_ADMINISTRATIVAS",
                "considera_custo_dre": false
              },
              {
                "id": "05d664ba-e2c7-4fa1-bc90-6d8aaf29e55b",
                "versao": 0,
                "nome": "13¬∫ Sal√°rio - 2¬™ Parcela",
                "categoria_pai": "54580768-11ae-4d32-a8e4-7cecc4b08d9b",
                "tipo": "DESPESA",
                "entrada_dre": "DESPESAS_ADMINISTRATIVAS",
                "considera_custo_dre": false
              },
              {
                "id": "61ad7511-4b9f-45c9-a89c-b4e5c1aa75c7",
                "versao": 0,
                "nome": "Adiantamento Salarial",
                "categoria_pai": "54580768-11ae-4d32-a8e4-7cecc4b08d9b",
                "tipo": "DESPESA",
                "entrada_dre": "DESPESAS_ADMINISTRATIVAS",
                "considera_custo_dre": false
              },
              {
                "id": "8f011838-aec3-48df-8d05-e1ae62229cb2",
                "versao": 0,
                "nome": "Adiantamentos para futuros Aumentos de Capital - AFAC",
                "categoria_pai": "80fcc5ed-a7d7-4680-b8ef-980c001f7c01",
                "tipo": "RECEITA",
                "entrada_dre": null,
                "considera_custo_dre": false
              },
              {
                "id": "1091cf0d-7453-4b3c-bae3-2a179ae16b44",
                "versao": 0,
                "nome": "√Ågua e Saneamento",
                "categoria_pai": "12b635f8-7d82-42eb-ac21-72b0032101c3",
                "tipo": "DESPESA",
                "entrada_dre": "DESPESAS_ADMINISTRATIVAS",
                "considera_custo_dre": false
              },
              {
                "id": "70957b7f-e260-42e7-a936-d077bf483953",
                "versao": 0,
                "nome": "Aluguel",
                "categoria_pai": "12b635f8-7d82-42eb-ac21-72b0032101c3",
                "tipo": "DESPESA",
                "entrada_dre": "DESPESAS_ADMINISTRATIVAS",
                "considera_custo_dre": false
              },
              {
                "id": "833c6f1e-535c-43e7-9383-069f62453215",
                "versao": 0,
                "nome": "Alvar√° de Funcionamento",
                "categoria_pai": "12b635f8-7d82-42eb-ac21-72b0032101c3",
                "tipo": "DESPESA",
                "entrada_dre": "DESPESAS_ADMINISTRATIVAS",
                "considera_custo_dre": false
              },
              {
                "id": "6bf48ee7-566a-406b-a093-636c6ce4c067",
                "versao": 0,
                "nome": "Antecipa√ß√£o de Lucros",
                "categoria_pai": "960d9260-cd9d-4282-834b-972e68a29c6f",
                "tipo": "DESPESA",
                "entrada_dre": null,
                "considera_custo_dre": false
              },
              {
                "id": "ecee04a9-5bf9-4ec7-901c-59b49e1e8679",
                "versao": 0,
                "nome": "Benfeitorias em Bens de Terceiros",
                "categoria_pai": "38130995-bdc4-42fd-8f46-5f9649fe384f",
                "tipo": "DESPESA",
                "entrada_dre": "INVESTIMENTOS_IMOBILIZADO",
                "considera_custo_dre": false
              },
              {
                "id": "a46a0ebb-5ca3-4ecf-bf29-61c78152ce9b",
                "versao": 0,
                "nome": "Bens de Pequeno Valor",
                "categoria_pai": "5693b0e4-27ee-43e1-920b-3590b1dfb035",
                "tipo": "DESPESA",
                "entrada_dre": "DESPESAS_ADMINISTRATIVAS",
                "considera_custo_dre": false
              }
            ]
          },
          "headers": {
            "content-type": "application/json",
            "date": "Mon, 22 Dec 2025 21:47:49 GMT",
            "vary": "Origin,Access-Control-Request-Method,Access-Control-Request-Headers",
            "x-request-id": "860cc655-4822-4a61-a83f-329d9d2c1bb4",
            "via": "1.1 google",
            "alt-svc": "h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000",
            "connection": "close",
            "transfer-encoding": "chunked"
          },
          "statusCode": 200,
          "statusMessage": "OK"
        }
      }
    ],
    "replace_code_to_token_conta_azul": [
      {
        "json": {
          "id_token": "eyJraWQiOiJjNFFVMDVNSVhSY0V3d01Dak8xcGtvWW1MRkVYaHZMbHREZk12TUFWQUpFPSIsImFsZyI6IlJTMjU2In0.eyJhdF9oYXNoIjoiQVlTNFN2NTU4bzVEN3p0VmlQajdsZyIsInN1YiI6ImMxMjE0N2U1LWZjZTktNGY5NC04NjljLTg2OTU4OTdkYTNmNSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuc2EtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3NhLWVhc3QtMV9WcDgzSjExd0EiLCJjb2duaXRvOnVzZXJuYW1lIjoiNDhjN2VhMTktNDcwMC00Yjc2LWJkYjItM2U0ZmJlNTUwMzA4QGRldnBvcnRhbC5jb20iLCJvcmlnaW5fanRpIjoiMzI3OGNkZjctY2QzOC00NzFlLTllYjAtOTViY2U5NmM2Mjg1IiwiYXVkIjoiNjUzcGNrMGVucWd0N2EwaWFmZjQ5Mm1mMTIiLCJ0b2tlbl91c2UiOiJpZCIsImF1dGhfdGltZSI6MTc2NjQ5Nzc1OSwiZXhwIjoxNzY2NTAxMzU5LCJpYXQiOjE3NjY0OTc3NTksImp0aSI6Ijc5YWU2NzlmLTZlZWEtNDRmZC04N2NmLTM5YWNhOTdmYjRjYiIsImVtYWlsIjoiNDhjN2VhMTktNDcwMC00Yjc2LWJkYjItM2U0ZmJlNTUwMzA4QGRldnBvcnRhbC5jb20ifQ.CpHfZy00j4ovSf4WqKBSG00i_jWRDEdujmr-rCecAeiijtJ3UGJTgrcVuQ2IHvgyO_21HzGETYi18YrCqhBjgnBwb1vNxfWc7mjmyD6N0T8phAgeqZwKZX90f3dzCG1tjJTCsECc9g1MJPgqZJn50OnEco-iPFZZCqEkJfwP18zTcnVtwuCjr8mvkhLrL3kMyVo9-nOt5nnMia4ijdKg4L4tvDdnLCOlIkpcN-vtGIMlcUuXO15PNjNa7gM20Dnq3JqhlpPVh0IlGCosvv4DG5D1CLnFCmIvkNHXsUQsTOZMmcWsawjuMwIYIfZtPlhbSNFptsLnPEc4oSfXI1U2pA",
          "access_token": "eyJraWQiOiJUa1BRbWs0UlR3M3RuWlZXcDdEanBURFhcL2RTajNvMU5SckI0R3I3ZzFTMD0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJjMTIxNDdlNS1mY2U5LTRmOTQtODY5Yy04Njk1ODk3ZGEzZjUiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuc2EtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3NhLWVhc3QtMV9WcDgzSjExd0EiLCJ2ZXJzaW9uIjoyLCJjbGllbnRfaWQiOiI2NTNwY2swZW5xZ3Q3YTBpYWZmNDkybWYxMiIsIm9yaWdpbl9qdGkiOiIzMjc4Y2RmNy1jZDM4LTQ3MWUtOWViMC05NWJjZTk2YzYyODUiLCJ0b2tlbl91c2UiOiJhY2Nlc3MiLCJzY29wZSI6ImF3cy5jb2duaXRvLnNpZ25pbi51c2VyLmFkbWluIG9wZW5pZCBwcm9maWxlIiwiYXV0aF90aW1lIjoxNzY2NDk3NzU5LCJleHAiOjE3NjY1MDEzNTksImlhdCI6MTc2NjQ5Nzc1OSwianRpIjoiMDBlZjNhN2MtMzY4ZS00MmYwLTk1ZjAtZGNjMjAzZDRkMDRmIiwidXNlcm5hbWUiOiI0OGM3ZWExOS00NzAwLTRiNzYtYmRiMi0zZTRmYmU1NTAzMDhAZGV2cG9ydGFsLmNvbSJ9.w9cwsa_d54jid9gCa2MaE5iKKKtzz0uNP4g-UymH8gTyK7T4QMzF5ve_WyE0o0f468NLTxGGtnpvDX1msgY209ar2ACjNhc61ORk0erHfH9yPLxobYhJXnDl2yE3nPqlO3MqkGhDb6a43ipSaElG0zLR4i1Xq5mvMTbNUutSHYTvW2E5Y4gkZiewcvWOHR5VtiY5kcjHk4BkYsVIVrM10-fQUQft1R7ifwXb_zyxYzp6PmwkmnR82-RMGJTQskifFTlrQtYdsda5b1uhSm9oQP4OyFrXnT2YnxVzzorqjg5CL_2q9B6uNPckdOj--NVHHORYinr4UBuaI7OsngBkJA",
          "refresh_token": "eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.x28axRRZ3RPOJcyzKrv0O8OMs8lMTUd25NiG9YoiB20lz92JKLuMe7gHh8qqeakMevLKRmQTFErRVtWLh6qumN8KXC8ARrcSQI9F1xoOiaH1KPiiVZrwU7s7V83EwLy14tueQ6D9qoq8EPUxHmwvny-na2lOqswQXwDUwyTBLnaEb0svISq5nB7xFaOCVzcMA8ggNAJPT53kSLie_2DpM6cBZL-ilqNTx9d0GRaCmCnhaLtAUlNoT6X_80XXT5P8sMUP399X5ZR4yYv1y6ieO1gAm2vJhot3-xBMo4KdSbEc5FhHsYAOVDUferjplaQa16dqDzOL15-j-W-WEn9ifA.grq-4_9a453BP0Il.claHpIl-XdCEO9P1wjSEqLcoQ_vw_DAPRhvm3V8nWhTbR5V3wCUcVOYhdjN9OoWKbdkFSDXhthuBpBYqZ8lZ6Bpcph5kyASWDUAcJ3dolpz0aIg3v7nL803lmpgSVuRFWZRXFkaoKp2kvecEC_04fPbn_IC9AvmU2XXLTH_QSwhKLhYI5e_-LJ5eMl-hThwaVh7qiUBltrBhI5rDhoP4b4GEq3LQgPDiB07WuKQsr5s9L-kwQvD_KHuo2ZshRhWLcyzYpJZqEIZU8WgcZ1PteaQbw5X2eGj2LfbgdgDsPidSsgkI4HwmmfLwjdMUrJAHrc5Dtehb5r6qxnC1qQ8GhGI1ujfxL9ZRPv6qGEVYg8vcHj8MLPFwHUVs7QHS8PrGTzMXkkRiZD3skgsTlAwijQzT4YbrIA5mrFGicwE1ustSdPobqNY3wpVqz7QeT_MWuLpsm4eGIH1quJCP7TtzhpWNsyO01ft8Mau5CJLuhTGlXk8ZD8KKdv1cKXnHHd2MhO7W3Ltyp4Gjtu-LNa6b5hIAbcMtWk7xb5QPwYFJU3cWUQf653Sus5wRsiAUE3HCZbKCIaTQCxCgGSh0ppbeOL5X1s_9-e06GKdZQSFLmOYypVbq_03umeNBDfljc-BWoqfeLk46pGIoCzMgHsZ2FSqPFl23c83wk3BlIAphT5Wrvo2M3P3S2WNHJECSaSMp223GKC20LLCVJHRmR9SymE0tSPovtNsEgF_FZ3MkKkMZi6BONHqN46XO7hDhuoeIMpHAqxjd9kpXPz4yz3X7sF7WB5bdBRn3oDlnota7Pzm7JP_nnTmATvyrtj8dFvIw0YzjW5fT1V8-evO0HSDyDijMAMO7IiQhGC0aLldzUPDv8vrpidEjITGMr8K7hSxxx8mJCoptbj-aYcnO2Qfd1mSVX3iNcmXt90Sjl8r9XV3d7HpOqdFkJPGn8FHQOr9mN2zNzUUgXda-aNsxKbvXe7nR79NA_ezu_aLSOqMduOIrvUq_BWa66SGzoxlAEBT35OKAt73wSvLVyBDMeQaS9kzKM2xnvtVlb2dd4fqHD1tDfDkKhOVkiwAHLl2k8O9bJ7N-Uf8G3sqgoMv2bCci5-8uzJRkHhA3nO6D8t7M48_WPNEuGKMj2Fijs3JIfKMiZjlIzWS1hvLmKk2DOHz_9YvyTW63HQttdyFrD50b5z-y_Gwr7cQUAlPrEJpF4LcZH_vL3FEKyuZXdZumaGrWmpm41y6yCYmYq5ISvLQRS9B3dVp_Zzyh67qCfHan0FtQy8kVwc-dnjKQu7cxfpqxwWUQuDBa_qvTNXYABDi9uV4bzA.XxWzdnPIGQ7mThaCYrk1AA",
          "expires_in": 3600,
          "token_type": "Bearer"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": false,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-12-23T14:54:43.993Z",
  "versionId": "7acf8544-c3a6-4e78-b8b9-0e1236f8dca6"
}